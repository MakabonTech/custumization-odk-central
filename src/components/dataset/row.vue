<!--
Copyright 2022 ODK Central Developers
See the NOTICE file at the top-level directory of this distribution and at
https://github.com/getodk/central-frontend/blob/master/NOTICE.

This file is part of ODK Central. It is subject to the license terms in
the LICENSE file found in the top-level directory of this distribution and at
https://www.apache.org/licenses/LICENSE-2.0. No part of ODK Central,
including this file, may be copied, modified, propagated, or distributed
except according to the terms contained in the LICENSE file.
-->
<template>
  <tr class="dataset-row">
    <td class="name">
      <router-link :to="datasetOverviewPage" v-tooltip.text>{{ dataset.name }}</router-link>
    </td>
    <td class="entities">
      <span>{{ $n(dataset.entities, 'default') }}</span>
    </td>
    <td>
      <span> <date-time :iso="dataset.lastEntity"/> </span>
    </td>
    <td class="conflicts">
      <span v-if="dataset.conflicts > 0">
        <router-link :to="datasetPath(dataset.projectId, dataset.name, 'entities?conflict=true')">
          <span class="wrap-circle">
            <span class="icon-warning"></span>
          </span>
          {{ $tcn('possibleConflictsCount', dataset.conflicts) }}
        </router-link>
      </span>
    </td>
    <td>
      <a class="btn btn-primary" :href="href">
        <span class="icon-download"></span>{{ $t('action.download') }}
      </a>
    </td>
  </tr>
</template>

<script>
import DateTime from '../date-time.vue';

import useRoutes from '../../composables/routes';
import { apiPaths } from '../../util/request';

export default {
  name: 'DatasetRow',
  components: { DateTime },
  props: {
    dataset: {
      type: Object,
      required: true
    }
  },
  setup() {
    const { datasetPath } = useRoutes();
    return { datasetPath };
  },
  computed: {
    href() {
      return apiPaths.entities(this.dataset.projectId, this.dataset.name, '.csv');
    },
    datasetOverviewPage() {
      return this.datasetPath(this.dataset.projectId, this.dataset.name);
    }
  }
};
</script>

<style lang="scss">
@import '../../assets/scss/mixins';

.dataset-row {
  .name {
    @include text-overflow-ellipsis;
    font-size: 18px;
   }
  .entities {
    text-align: right;
    padding-right: 10%;
  }
  .wrap-circle {
    width: 22px;
    display: inline-block;
    background: $color-danger;
    height: 22px;
    border-radius: 15px;
    text-align: center;
    color: white;

    margin-right: 3px;
  }
  .icon-warning { font-size: 12px; }
  .conflicts a {
    color: $color-danger;
  }
}
</style>

<i18n lang="json5">
{
  "en": {
    "action": {
      "download": "Download data (.csv)"
    },
    "possibleConflictsCount": "{count} possible conflict | {count} possible conflicts"
  }
}
</i18n>

<!-- Autogenerated by destructure.js -->
<i18n>
{
  "cs": {
    "action": {
      "download": "Stáhnout data (.csv)"
    }
  },
  "de": {
    "action": {
      "download": "Daten herunterladen (.csv)"
    }
  },
  "es": {
    "action": {
      "download": "Descargar datos (.csv)"
    },
    "possibleConflictsCount": "{count} posible conflicto | {count} posibles conflictos | {count} posibles conflictos"
  },
  "fr": {
    "action": {
      "download": "Télécharger les données (.csv)"
    },
    "possibleConflictsCount": "{count} conflit possible | {count} conflits possibles | {count} conflits possibles"
  },
  "it": {
    "action": {
      "download": "Scarica dati (.csv)"
    },
    "possibleConflictsCount": "{count} possibile conflitto | {count} possibili conflitti | {count} possibili conflitti"
  },
  "sw": {
    "action": {
      "download": "Pakua data (.csv)"
    }
  }
}
</i18n>
