import{_ as J}from"./breadcrumbs-SpsHxTta.js";import{z as D,H as Q,J as A,a4 as X,W as N,A as Y,r as j,g as E,c as f,p as g,o as i,k as _,e as c,d as I,i as l,h as Z,f as b,t as m,ac as B,u as $,at as H,av as tt,aw as T,_ as et,Q as st,L as ot,q as K,C as L,ap as nt,D as C,n as F}from"./index-BJJ6YbMy.js";import{_ as at}from"./head-DeISpnNl.js";import{M as rt}from"./view-WEETJ_m_.js";import{u as it}from"./datasets-C5NDv_lC.js";import{u as ct}from"./tabs-BBTLywO7.js";import"./linkable-ByHyCO2J.js";function O(e){const o=e;o.__i18n=o.__i18n||[],o.__i18n.push({locale:"",resource:{en:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Add Project notes, links, instructions and other resources to this space in "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Project Settings"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Only Project Managers can see this suggestion."}}}}})}function q(e){const o=e;o.__i18n=o.__i18n||[],o.__i18n.push({locale:"",resource:{cs:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Přidejte poznámky k projektu, odkazy, pokyny a další zdroje do tohoto prostoru v "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Nastavení Projektu"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Tento návrh mohou zobrazit pouze projektoví manažeři."}}},de:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Fügen Sie diesem Bereich Projektnotizen, Links, Anleitungen und andere Ressourcen hinzu "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Projekt-Einstellungen"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Nur Projektmanager können diesen Vorschlag sehen."}}},es:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Agregue notas del proyecto, enlaces, instrucciones y otros recursos a este espacio en "},{t:4,k:"projectSettings"}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Configuración del proyecto"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Solo los administradores de proyectos pueden ver esta sugerencia."}}},fr:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Ajoutez des notes, des liens, des instructions ou autres ressources relatifs au Projet à cet espace dans "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Paramètres du projet"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Seuls les Gestionnaires de Projet peuvent voir cette suggestion."}}},id:{note:{t:0,b:{t:2,i:[{t:3}],s:"Hanya Manajer Proyek yang dapat melihat saran ini."}}},it:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Aggiungi note di progetto, collegamenti, istruzioni e altre risorse a questo spazio in "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Impostazioni del progetto"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Solo i Project Manager possono vedere questo suggerimento."}}},pt:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Adicione notas de Projeto, links, instruções e outros recursos neste espaço em "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Configurações do Projeto"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Somente Gerentes de Projeto podem ver esta sugestão."}}},sw:{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"Ongeza madokezo ya Mradi, viungo, maagizo na nyenzo zingine kwenye nafasi hii katika "},{t:4,k:"projectSettings"},{t:3,v:"."}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"Mipangilio ya Mradi"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"Wasimamizi wa Miradi pekee ndio wanaoweza kuona pendekezo hili."}}},"zh-Hant":{instructions:{full:{t:0,b:{t:2,i:[{t:3,v:"可由 "},{t:4,k:"projectSettings"},{t:3,v:" ，新增專案註釋、連結、指示和其他資源至以下空間。"}]}},projectSettings:{t:0,b:{t:2,i:[{t:3}],s:"專案設定"}}},note:{t:0,b:{t:2,i:[{t:3}],s:"只有專案管理員才能看到此建議。"}}}}})}const lt={key:1,id:"project-overview-description-update"},dt={class:"note"},M=Object.assign({name:"ProjectOverviewDescription"},{__name:"description",props:{description:{type:String},canUpdate:{type:Boolean}},setup(e){const o=e,{projectPath:y}=D(),t=Q(()=>!o.description),s=A(null),n=A(null),k=(a,p,r)=>{const h=p-a.paddingTop-a.paddingBottom;return Math.round(h/r)},d=(a,p)=>{let r=0,h=0;for(let P=0;P<a.children.length;P+=1){const w=a.children[P],U=window.getComputedStyle(w),S=B(U);let{lineHeight:x}=S;w.tagName==="IMG"&&(x=20);const z=k(S,w.offsetHeight,x),V=a.children[P-1]?B(window.getComputedStyle(a.children[P-1])).marginBottom:0,R=Math.max(S.marginTop-V,0),G=R+w.offsetHeight+S.marginBottom;if(r+z>p||r+z===p&&P+1<a.children.length){const W=p-r-.5;return h+R+S.paddingTop+W*x}r+=z,h+=G}return null},u=()=>{if(!s.value)return;const a=n.value&&s.value.$el.style.height==="auto";n.value=d(s.value.$el,4),!a&&n.value?s.value.$el.style.height=`${n.value}px`:s.value.$el.style.height="auto"};X(()=>{N(u)}),Y(()=>o.description,()=>N(u));const v=()=>{n.value&&s.value.$el.style.height==="auto"?s.value.$el.style.height=`${n.value}px`:s.value.$el.style.height="auto"};return(a,p)=>{const r=j("router-link"),h=j("i18n-t");return t.value?e.canUpdate?(i(),f("div",lt,[c(h,{tag:"div",class:"instructions",keypath:"instructions.full"},{projectSettings:l(()=>[c(r,{to:Z(y)("settings")},{default:l(()=>[b(m(a.$t("instructions.projectSettings")),1)]),_:1},8,["to"])]),_:1}),I("div",dt,m(a.$t("note")),1)])):g("",!0):(i(),E(rt,{key:0,id:"project-overview-description",ref_key:"markdownRef",ref:s,class:_({clickable:n.value}),"raw-markdown":e.description,onClick:v},null,8,["class","raw-markdown"]))}}});typeof O=="function"&&O(M);typeof q=="function"&&q(M);const ut=()=>{const{project:e,createResource:o,createGetter:y}=$(),t=o("projectAssignments"),s=o("forms",()=>({transformResponse:H})),n=o("deletedForms",()=>({transformResponse:H})),k=o("formSummaryAssignments"),d=o("fieldKeys",()=>({withToken:tt(()=>d.filter(v=>v.token!=null))}));T(()=>{e.dataExists&&s.dataExists&&e.forms!==s.length&&(e.forms=s.length)}),T(()=>{e.dataExists&&d.dataExists&&e.appUsers!==d.length&&(e.appUsers=d.length)});const u=y("duplicateFormNames",()=>{if(!(s.dataExists&&n.dataExists))return null;const v=[...s,...n],a=new Set,p=new Set;for(const r of v){const h=r.nameOrId.toLocaleLowerCase();a.has(h)&&p.add(h),a.add(h)}return p});return{project:e,projectAssignments:t,forms:s,deletedForms:n,formSummaryAssignments:k,fieldKeys:d,duplicateFormNames:u}},pt={name:"ProjectShow",components:{Breadcrumbs:J,Loading:ot,PageBody:st,PageHead:at,ProjectOverviewDescription:M},props:{projectId:{type:String,required:!0}},setup(){const{project:e,forms:o,fieldKeys:y}=ut(),t=it(),{projectPath:s,canRoute:n}=D(),{tabPath:k,tabClass:d}=ct(s());return{project:e,forms:o,datasets:t,fieldKeys:y,tabPath:k,tabClass:d,projectPath:s,canRoute:n}},computed:{breadcrumbLinks(){return[{text:this.project.dataExists?this.project.nameWithArchived:this.$t("resource.project"),path:this.projectPath(),icon:"icon-archive"}]},canUpdate(){return this.project.dataExists&&this.project.permits("project.update")}},created(){this.fetchProject(!1)},methods:{fetchProject(e){this.project.request({url:C.project(this.projectId),extended:!0,resend:e}).catch(F)},fetchForms(e){this.forms.request({url:C.forms(this.projectId),extended:!0,resend:e}).catch(F),this.forms.dataExists||(this.datasets.data=null)},fetchFieldKeys(e){this.fieldKeys.request({url:C.fieldKeys(this.projectId),extended:!0,resend:e}).catch(F)}}},mt={key:0,class:"badge"},ht={key:0,class:"badge"};function gt(e,o,y,t,s,n){const k=j("breadcrumbs"),d=j("project-overview-description"),u=j("router-link"),v=j("page-head"),a=j("loading"),p=j("router-view"),r=j("page-body");return i(),f("div",null,[t.project.dataExists?(i(),E(k,{key:0,links:n.breadcrumbLinks},null,8,["links"])):g("",!0),K(c(v,null,nt({description:l(()=>[t.project.dataExists?(i(),E(d,{key:0,description:t.project.description,"can-update":n.canUpdate},null,8,["description","can-update"])):g("",!0)]),tabs:l(()=>[I("li",{class:_(t.tabClass("")),role:"presentation"},[c(u,{to:t.tabPath("")},{default:l(()=>[b(m(e.$t("resource.forms"))+" ",1),t.project.dataExists?(i(),f("span",mt,m(e.$n(t.project.forms,"default")),1)):g("",!0)]),_:1},8,["to"])],2),t.canRoute(t.tabPath("entity-lists"))?(i(),f("li",{key:0,class:_(t.tabClass("entity-lists")),role:"presentation"},[c(u,{to:t.tabPath("entity-lists")},{default:l(()=>[b(m(e.$t("resource.entityLists"))+" ",1),t.project.dataExists?(i(),f("span",ht,m(e.$n(t.project.datasets,"default")),1)):g("",!0)]),_:1},8,["to"])],2)):g("",!0),t.canRoute(t.tabPath("users"))?(i(),f("li",{key:1,class:_(t.tabClass("users")),role:"presentation"},[c(u,{to:t.tabPath("users")},{default:l(()=>[b(m(e.$t("resource.projectRoles")),1)]),_:1},8,["to"])],2)):g("",!0),t.canRoute(t.tabPath("app-users"))?(i(),f("li",{key:2,class:_(t.tabClass("app-users")),role:"presentation"},[c(u,{to:t.tabPath("app-users")},{default:l(()=>[b(m(e.$t("resource.appUsers")),1)]),_:1},8,["to"])],2)):g("",!0),t.canRoute(t.tabPath("form-access"))?(i(),f("li",{key:3,class:_(t.tabClass("form-access")),role:"presentation"},[c(u,{to:t.tabPath("form-access")},{default:l(()=>[b(m(e.$t("projectShow.tab.formAccess")),1)]),_:1},8,["to"])],2)):g("",!0),t.canRoute(t.tabPath("settings"))?(i(),f("li",{key:4,class:_(t.tabClass("settings")),role:"presentation"},[c(u,{to:t.tabPath("settings")},{default:l(()=>[b(m(e.$t("common.tab.settings")),1)]),_:1},8,["to"])],2)):g("",!0)]),_:2},[t.project.dataExists?{name:"title",fn:l(()=>[b(m(t.project.nameWithArchived),1)]),key:"0"}:void 0]),1536),[[L,t.project.dataExists]]),c(r,null,{default:l(()=>[c(a,{state:t.project.initiallyLoading},null,8,["state"]),K(c(p,{onFetchProject:n.fetchProject,onFetchForms:n.fetchForms,onFetchFieldKeys:n.fetchFieldKeys},null,8,["onFetchProject","onFetchForms","onFetchFieldKeys"]),[[L,t.project.dataExists]])]),_:1})])}const Pt=et(pt,[["render",gt]]);export{Pt as default};
