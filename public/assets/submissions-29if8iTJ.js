import{_ as C,L as w,r as o,c as b,o as c,e as n,q as p,C as D,i as f,d as l,g as j,p as g,f as _,t as h,F as I,k as L,v as R,D as y,n as z,u as K,O as M,H as P,a0 as q,P as A}from"./index-BJJ6YbMy.js";import{E as B}from"./fill-jYfh2lBR.js";import{_ as N}from"./section-EpBA88m2.js";import{_ as T,O as V}from"./data-access-IUfhukHl.js";import{S as H,u as Q}from"./submissions-CXHkJ0ed.js";import{u as U}from"./query-ref-D9qdbv9b.js";import"./modal-BMSEXbZM.js";import"./selectable-DuI9cV1N.js";import"./datetime-3JD3bssD.js";import"./odata-loading-message-C4DiRpoY.js";import"./date-range-picker-1tVSoL2V.js";import"./review-state-DuiKQZfx.js";import"./date-time-CEONMtaY.js";import"./review-state-m1o3bY3s.js";import"./freeze-CDRjGwqt.js";import"./chunky-array-CH9f7RmW.js";import"./fields-BTJfkXdT.js";import"./textarea-DfIc8ncZ.js";import"./view-WEETJ_m_.js";import"./request--gXHIWga.js";import"./pagination-DLInApQo.js";function S(s){const e=s;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"OData access is unavailable due to Form encryption"}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"OData access is unavailable for deleted Submissions"}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"Submissions and Submission-related data are deleted after 30 days in the Trash"}},action:{toggleDeletedSubmissions:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" deleted Submission"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" deleted Submissions"}]}]}}}}}})}function x(s){const e=s;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{cs:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"Přístup k OData není dostupný kvůli šifrování formuláře"}}},de:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"OData-Zugriff ist wegen Formularverschlüsselung nicht verfügbar."}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"Der OData-Zugriff ist für gelöschte Übermittlungen nicht verfügbar"}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"Übermittlungen und übermittlungsbezogene Daten werden nach 30 Tagen im Papierkorb gelöscht."}},action:{toggleDeletedSubmissions:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" gelöscht Übermittlung"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" gelöschte Übermittlungen"}]}]}}}},es:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"El acceso a OData no está disponible debido al cifrado de Formulario"}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"El acceso OData no está disponible para los envíos eliminados"}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"Los envíos y los datos relacionados con ellos se eliminan después de 30 días en la papelera."}},action:{toggleDeletedSubmissions:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Envío eliminado"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Envíos eliminados"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Envíos eliminados"}]}]}}}},fr:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"L'accès à OData n'est pas disponible en raison du chiffrement du formulaire"}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"L'accès OData n'est pas possible pour les soumissions supprimées."}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"Les soumissions et les données associées sont supprimées aprés 30 jours passés dans la corbeille."}},action:{toggleDeletedSubmissions:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Soumission supprimée"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Soumissions supprimées"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Soumissions supprimées"}]}]}}}},it:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"L'accesso OData non è disponibile a causa della crittografia del formulario"}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"L'accesso OData non è disponibile per gli Invii cancellati"}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"Gli invii e i dati relativi agli invii vengono eliminati dopo 30 giorni nel Cestino."}},action:{toggleDeletedSubmissions:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" invio cancellato"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" invii cancellati"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" invii cancellati"}]}]}}}},pt:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"O acesso ao OData não está disponível devido à encriptação do Formulário"}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"O acesso ao OData não está disponível devido às Respostas excluídas"}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"Respostas e dados relacionados a Respostas são deletados depois de 30 dias na Lixeira"}},action:{toggleDeletedSubmissions:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Resposta excluída"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Respostas excluídas"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Respostas excluídas"}]}]}}}},sw:{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"Ufikiaji wa OData haupatikani kwa sababu ya usimbaji fiche wa Fomu"}}},"zh-Hant":{analyzeDisabled:{t:0,b:{t:2,i:[{t:3}],s:"由於表單加密，OData 存取不可用"}},analyzeDisabledDeletedData:{t:0,b:{t:2,i:[{t:3}],s:"對於已刪除的提交內容，OData 存取不可用"}},purgeDescription:{t:0,b:{t:2,i:[{t:3}],s:"提交內容和與提交內容相關的資料將在 30 天後從垃圾箱中刪除"}},action:{toggleDeletedSubmissions:{t:0,b:{t:2,i:[{t:3,v:"已刪除"},{t:4,k:"count"},{t:3,v:" 筆提交內容"}]}}}}}})}const v={name:"FormSubmissions",components:{EnketoFill:B,Loading:w,OdataAnalyze:V,OdataDataAccess:T,PageSection:N,SubmissionList:H},props:{projectId:{type:String,required:!0},xmlFormId:{type:String,required:!0}},setup(){const{project:s,form:e,createResource:d}=K(),{deletedSubmissionCount:t}=Q(),k=d("keys"),i=M(),r=U({fromQuery:a=>typeof a.deleted=="string"&&a.deleted==="true",toQuery:a=>({deleted:a===!0?"true":null})}),u=P(()=>s.dataExists&&s.permits("submission.delete"));return q(()=>{r.value&&s.dataExists&&!u.value&&i.push("/")}),{project:s,form:e,keys:k,analyzeModal:A(),deletedSubmissionCount:t,canDelete:u,deleted:r}},computed:{rendersEnketoFill(){return this.project.dataExists&&this.project.permits("submission.create")&&this.form.dataExists},analyzeDisabled(){return!!(this.keys.dataExists&&this.keys.length!==0||this.form.dataExists&&this.form.keyId!=null&&this.form.submissions===0||this.deleted)},analyzeDisabledMessage(){return this.deleted?this.$t("analyzeDisabledDeletedData"):this.$t("analyzeDisabled")},odataUrl(){if(!this.form.dataExists)return"";const s=y.odataSvc(this.projectId,this.xmlFormId);return`${window.location.origin}${s}`}},created(){this.fetchKeys(),this.deleted||this.fetchDeletedCount()},methods:{fetchKeys(){this.keys.request({url:y.submissionKeys(this.projectId,this.xmlFormId)}).catch(z)},fetchDeletedCount(){this.deletedSubmissionCount.request({method:"GET",url:y.odataSubmissions(this.projectId,this.xmlFormId,this.draft,{$top:0,$count:!0,$filter:"__system/deletedAt ne null"})}).catch(z)},toggleDeleted(){const{path:s}=this.$route;this.$router.push(this.deleted?s:`${s}?deleted=true`)}}},G={id:"form-submissions"},Z={class:"form-submissions-heading-row"},J={class:"icon-close"};function W(s,e,d,t,k,i){const r=o("loading"),u=o("enketo-fill"),a=o("odata-data-access"),O=o("submission-list"),E=o("page-section"),F=o("odata-analyze");return c(),b("div",G,[n(r,{state:t.keys.initiallyLoading},null,8,["state"]),p(n(E,null,{heading:f(()=>[l("div",Z,[i.rendersEnketoFill?(c(),j(u,{key:0,"form-version":t.form},{default:f(()=>[e[3]||(e[3]=l("span",{class:"icon-plus-circle"},null,-1)),_(h(s.$t("action.createSubmission")),1)]),_:1,__:[3]},8,["form-version"])):g("",!0),t.deletedSubmissionCount.dataExists?(c(),b(I,{key:1},[t.canDelete&&(t.deletedSubmissionCount.value>0||t.deleted)?(c(),b("button",{key:0,type:"button",class:L(["btn toggle-deleted-submissions",{"btn-danger":t.deleted,"btn-link":!t.deleted}]),onClick:e[0]||(e[0]=(...m)=>i.toggleDeleted&&i.toggleDeleted(...m))},[e[4]||(e[4]=l("span",{class:"icon-trash"},null,-1)),_(h(s.$tcn("action.toggleDeletedSubmissions",t.deletedSubmissionCount.value))+" ",1),p(l("span",J,null,512),[[D,t.deleted]])],2)):g("",!0)],64)):g("",!0),p(l("p",{class:"purge-description"},h(s.$t("purgeDescription")),513),[[D,t.deleted]]),n(a,{"analyze-disabled":i.analyzeDisabled,"analyze-disabled-message":i.analyzeDisabledMessage,onAnalyze:e[1]||(e[1]=m=>t.analyzeModal.show())},null,8,["analyze-disabled","analyze-disabled-message"])])]),body:f(()=>[n(O,{ref:"submissionList","project-id":d.projectId,"xml-form-id":d.xmlFormId,deleted:t.deleted,onFetchKeys:i.fetchKeys,onFetchDeletedCount:i.fetchDeletedCount},null,8,["project-id","xml-form-id","deleted","onFetchKeys","onFetchDeletedCount"])]),_:1},512),[[D,t.keys.dataExists]]),n(F,R(t.analyzeModal,{"odata-url":i.odataUrl,onHide:e[2]||(e[2]=m=>t.analyzeModal.hide())}),null,16,["odata-url"])])}typeof S=="function"&&S(v);typeof x=="function"&&x(v);const he=C(v,[["render",W]]);export{he as default};
