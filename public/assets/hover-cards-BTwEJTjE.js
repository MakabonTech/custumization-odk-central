import{D as g}from"./date-time-CEONMtaY.js";import{J as N,a4 as j,c as y,o as u,d as t,k as B,R as C,ac as z,ab as V,u as w,g as v,i as c,p as O,h as a,F as S,j as D,t as n,e as b,f as _,H as q,ax as E,G as A,am as F,A as P,x as W,D as $}from"./index-BJJ6YbMy.js";import{_ as L}from"./dl-data-DrvvNHng.js";import{F as M}from"./string-BTvN1Cbp.js";import{_ as U}from"./review-state-m1o3bY3s.js";import{P as T}from"./popover-fHmQKbVx.js";import{u as G}from"./submission-YNzTK585.js";import"./datetime-3JD3bssD.js";import"./review-state-DuiKQZfx.js";const J={class:"hover-card-heading"},K={class:"hover-card-title"},Q={class:"hover-card-subtitle"},X={class:"hover-card-footer"},k=Object.assign({name:"HoverCard"},{__name:"hover-card",props:{icon:{type:String,required:!0},truncateDt:{type:Boolean,default:!0}},setup(p){const r=p,e=N(null),f=s=>{const m=s.querySelector("dt");if(m==null)return 0;const d=m.getBoundingClientRect().width,o=s.querySelector("dd").getBoundingClientRect().width;return d+Math.min(d,o)};return j(()=>{if(r.truncateDt)return;const s=e.value.querySelector(".hover-card-body"),m=z(getComputedStyle(s)),d=s.getBoundingClientRect().width-m.borderLeft-m.borderRight,o=[...e.value.querySelectorAll(":scope > :not(.hover-card-body)")];for(const h of o)h.style.display="none";e.value.style.width="auto";const i=f(s);e.value.style.width="";for(const h of o)h.style.display="";i>d&&(e.value.style.width=V(e.value.getBoundingClientRect().width+i-d))}),(s,m)=>(u(),y("div",{ref_key:"el",ref:e,class:"hover-card"},[t("div",J,[t("span",{class:B(`icon-${p.icon}`)},null,2),t("div",null,[t("div",K,[C(s.$slots,"title")]),t("div",Q,[C(s.$slots,"subtitle")])])]),t("div",{class:B(["hover-card-body",{"truncate-dt":p.truncateDt}])},[C(s.$slots,"body")],2),t("div",X,[C(s.$slots,"footer")])],512))}}),Y={class:"dl-horizontal"},Z={key:0,class:"hover-card-dataset-property-list"},I=Object.assign({name:"HoverCardDataset"},{__name:"dataset",setup(p){const{dataset:r}=w();return(e,f)=>(u(),v(k,{icon:"database","truncate-dt":!1},{title:c(()=>[_(n(a(r).name),1)]),subtitle:c(()=>[_(n(e.$t("resource.entityList")),1)]),body:c(()=>[t("dl",Y,[t("dt",null,n(e.$t("resource.entities")),1),t("dd",null,n(e.$n(a(r).entities,"default")),1),t("dt",null,n(e.$t("resource.properties")),1),t("dd",null,n(e.$n(a(r).properties.length,"default")),1),t("dt",null,n(e.$t("header.lastEntity")),1),t("dd",null,[b(g,{iso:a(r).lastEntity},null,8,["iso"])]),t("dt",null,n(e.$t("common.lastUpdate")),1),t("dd",null,[b(g,{iso:a(r).lastUpdate},null,8,["iso"])])])]),footer:c(()=>[a(r).properties.length!==0?(u(),y("div",Z,[(u(!0),y(S,null,D(a(r).properties,({name:l})=>(u(),y("div",{key:l},n(l),1))),128))])):O("",!0)]),_:1}))}}),x={class:"dl-horizontal"},ee=Object.assign({name:"HoverCardEntity"},{__name:"entity",setup(p){const{dataset:r,entity:e}=w(),f=q(()=>{const{properties:s}=r,m=Math.min(s.length,5);return new Array(m).fill(null).map((d,o)=>s[o].name)}),l=q(()=>e.currentVersion.data);return(s,m)=>(u(),v(k,{icon:"cube"},{title:c(()=>[_(n(a(e).currentVersion.label),1)]),subtitle:c(()=>[_(n(s.$t("resource.entity")),1)]),body:c(()=>[t("dl",x,[t("dt",null,n(s.$t("resource.entityList")),1),t("dd",null,n(a(r).name),1),t("dt",null,n(s.$t("common.lastUpdate")),1),t("dd",null,[b(g,{iso:a(e).updatedAt??a(e).createdAt},null,8,["iso"])]),(u(!0),y(S,null,D(f.value,d=>(u(),v(L,{key:d,name:d,value:l.value[d]},null,8,["name","value"]))),128))])]),_:1}))}}),te={class:"dl-horizontal"},se=Object.assign({name:"HoverCardForm"},{__name:"form",setup(p){const{form:r}=w();return(e,f)=>(u(),v(k,{icon:"file","truncate-dt":!1},{title:c(()=>[_(n(a(r).nameOrId),1)]),subtitle:c(()=>[_(n(e.$t("resource.form")),1)]),body:c(()=>[t("dl",te,[t("dt",null,n(e.$t("common.version")),1),t("dd",null,[b(M,{version:a(r).version},null,8,["version"])]),t("dt",null,n(e.$t("resource.submissions")),1),t("dd",null,n(e.$n(a(r).submissions,"default")),1),t("dt",null,n(e.$t("header.lastSubmission")),1),t("dd",null,[b(g,{iso:a(r).lastSubmission},null,8,["iso"])])])]),_:1}))}}),ne={class:"dl-horizontal"},oe=Object.assign({name:"HoverCardSubmission"},{__name:"submission",setup(p){const{form:r,submission:e}=w(),f=q(()=>{const l=e.__id,s=l.match(/^((?:uuid:)?[0-9a-f]{8})[0-9a-f-]+([0-9a-f]{8})$/);return s!=null?[s[1],"â€¦",s[2]]:[l]});return(l,s)=>(u(),v(k,{icon:"tag","truncate-dt":!1},{title:c(()=>[a(e).instanceName!=null?(u(),y(S,{key:0},[_(n(a(e).instanceName),1)],64)):(u(!0),y(S,{key:1},D(f.value,(m,d)=>(u(),y("span",{key:d},n(m),1))),128))]),subtitle:c(()=>[_(n(l.$t("resource.submission")),1)]),body:c(()=>[t("dl",ne,[t("dt",null,n(l.$t("resource.form")),1),t("dd",null,n(a(r).nameOrId),1),t("dt",null,n(l.$t("header.submitterName")),1),t("dd",null,n(a(e).__system.submitterName),1),t("dt",null,n(l.$t("header.submissionDate")),1),t("dd",null,[b(g,{iso:a(e).__system.submissionDate},null,8,["iso"])]),t("dt",null,n(l.$t("common.reviewState")),1),t("dd",null,[b(U,{value:a(e).__system.reviewState},null,8,["value"])])])]),_:1}))}}),re=()=>{const{createResource:p}=w(),{submission:r}=G();return{form:p("form",()=>({transformResponse:({data:e})=>E(e)})),submission:r,dataset:p("dataset"),entity:p("entity")}},fe={__name:"hover-cards",setup(p){const r={form:{component:se,requests:({projectId:o,xmlFormId:i})=>({form:{url:$.form(o,i),extended:!0}})},submission:{component:oe,requests:({projectId:o,xmlFormId:i,instanceId:h})=>({form:{url:$.form(o,i)},submission:{url:$.odataSubmission(o,i,h,{$select:"__id,__system,meta"})}})},dataset:{component:I,requests:({projectId:o,name:i})=>({dataset:{url:$.dataset(o,i),extended:!0}})},entity:{component:ee,requests:({projectId:o,dataset:i,uuid:h})=>({dataset:{url:$.dataset(o,i)},entity:{url:$.entity(o,i,h)}})}},e=re(),f=()=>{for(const o of Object.values(e))o.reset()},l=A("hoverCard"),s=F(null),m=()=>{const o=r[l.type];if(o==null)throw new Error(`unknown type of hover card: '${l.type}'`);const i=Object.entries(o.requests(l.data)).map(([h,H])=>{const R=e[h];if(R==null)throw new Error(`unknown resource: '${h}'`);return R.request({...H,alert:!1})});Promise.all(i).then(()=>{s.value=o.component}).catch(f)},d=()=>{f(),s.value=null};return P(()=>l.anchor,(o,i)=>{i!=null&&d(),o!=null&&m()}),(o,i)=>(u(),v(T,{target:s.value!=null?a(l).anchor:null,placement:"right",onHide:i[0]||(i[0]=h=>a(l).hide())},{default:c(()=>[s.value!=null?(u(),v(W(s.value),{key:0})):O("",!0)]),_:1},8,["target"]))}};export{fe as default};
