import{m as K,_ as z,c as r,o as n,d as o,t as d,F as y,j as E,k as J,r as k,e as h,w as G,l as W,f as v,p as m,q as _,g as $,s as X,v as Y,x as tt,i as C,y as et,z as it,u as H,h as f,A as at,B as S,L as st,C as nt,D as ot,n as rt}from"./index-BJJ6YbMy.js";import{D as O}from"./datetime-3JD3bssD.js";import{D as lt}from"./date-range-picker-1tVSoL2V.js";import{_ as dt}from"./actor-link-Dpyb0cJk.js";import{_ as Q}from"./link-6wXOPrfc.js";import{_ as U}from"./link-CVIq4c0k.js";import{D as ut}from"./date-time-CEONMtaY.js";import{_ as ct}from"./selectable-DuI9cV1N.js";import{u as R}from"./query-ref-D9qdbv9b.js";import"./link-if-can-B5zC8OjL.js";import"./hover-card-hXE3Fll1.js";const pt=t=>{const e=t.indexOf(".");if(e===-1)return`audit.action.${t}`;const i=t.slice(0,e),u=t.slice(e+1).replace(/[.-]/g,"_");return`audit.action.${i}.${u}`},A=K(({i18n:t})=>({categoryMessage:e=>{const i=`audit.category.${e}`;return t.te(i,t.fallbackLocale)?t.t(i):null},actionMessage:e=>{const i=pt(e);return t.te(i,t.fallbackLocale)?t.t(i):null}})),gt={name:"AuditFiltersAction",props:{modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(){const{categoryMessage:t,actionMessage:e}=A();return{categoryMessage:t,actionMessage:e}},computed:{options(){return[this.categoryOption("nonverbose"),this.categoryOption("user"),this.actionOption("user.create"),this.actionOption("user.update"),this.actionOption("user.assignment.create"),this.actionOption("user.assignment.delete"),this.actionOption("user.session.create"),this.actionOption("user.delete"),this.categoryOption("project"),this.actionOption("project.create"),this.actionOption("project.update"),this.actionOption("project.delete"),this.categoryOption("form"),this.actionOption("form.create"),this.actionOption("form.update"),this.actionOption("form.update.draft.set"),this.actionOption("form.update.publish"),this.actionOption("form.update.draft.delete"),this.actionOption("form.update.draft.replace"),this.actionOption("form.attachment.update"),this.actionOption("form.submission.export"),this.actionOption("form.delete"),this.actionOption("form.purge"),this.actionOption("form.restore"),this.categoryOption("field_key"),this.actionOption("field_key.create"),this.actionOption("field_key.assignment.create"),this.actionOption("field_key.assignment.delete"),this.actionOption("field_key.session.end"),this.actionOption("field_key.delete"),this.categoryOption("public_link"),this.actionOption("public_link.create"),this.actionOption("public_link.assignment.create"),this.actionOption("public_link.assignment.delete"),this.actionOption("public_link.session.end"),this.actionOption("public_link.delete"),this.categoryOption("dataset"),this.actionOption("dataset.create"),this.actionOption("dataset.update"),this.categoryOption("config"),this.actionOption("config.set"),this.categoryOption("upgrade")]},displayValue(){return this.categoryMessage(this.modelValue)?this.categoryMessage(this.modelValue):this.actionMessage(this.modelValue)}},methods:{categoryOption(t){return{text:`» ${this.categoryMessage(t)}`,value:t,htmlClass:"audit-filters-action-category"}},actionOption(t){return{text:`      ${this.actionMessage(t)}`,value:t}}}},mt={id:"audit-filters-action",class:"form-group"},ht={class:"display-value","aria-hidden":"true"},ft=["value"],bt=["value"];function _t(t,e,i,p,u,a){return n(),r("label",mt,[o("span",null,d(t.$t("field.type")),1),o("div",ht,d(a.displayValue),1),o("select",{class:"form-control",value:i.modelValue,onChange:e[0]||(e[0]=l=>t.$emit("update:modelValue",l.target.value))},[(n(!0),r(y,null,E(a.options,l=>(n(),r("option",{key:l.value,class:J(l.htmlClass),value:l.value},d(l.text),11,bt))),128))],40,ft),e[1]||(e[1]=o("span",{class:"icon-angle-down"},null,-1))])}const yt=z(gt,[["render",_t]]);function V(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(none)"}}}}})}function I(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{de:{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(keine)"}}},es:{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(ninguno)"}}},fr:{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(Aucune)"}}},it:{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(nessuno)"}}},pt:{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(nenhum)"}}},"zh-Hant":{noLogDateSelected:{t:0,b:{t:2,i:[{t:3}],s:"(無)"}}}}})}const L={name:"AuditFilters",components:{AuditFiltersAction:yt,DateRangePicker:lt},props:{action:{type:String,required:!0},dateRange:{type:Array,required:!0}},emits:["update:action","update:dateRange"]};function kt(t,e,i,p,u,a){const l=k("audit-filters-action"),b=k("date-range-picker");return n(),r("form",{class:"form-inline",onSubmit:e[2]||(e[2]=G(()=>{},["prevent"]))},[h(l,{"model-value":i.action,"onUpdate:modelValue":e[0]||(e[0]=s=>t.$emit("update:action",s))},null,8,["model-value"]),h(b,{"model-value":i.dateRange,label:t.$t("field.dateRange"),required:"",placeholder:t.$t("noLogDateSelected"),"onUpdate:modelValue":e[1]||(e[1]=s=>t.$emit("update:dateRange",s))},null,8,["model-value","label","placeholder"])],32)}typeof V=="function"&&V(L);typeof I=="function"&&I(L);const vt=z(L,[["render",kt]]);function F(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"This resource has been deleted."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"This resource has been purged."}}}}})}function P(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{cs:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Tento zdroj byl smazán."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Tento zdroj byl vyčištěn."}}},de:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Diese Ressource wurde gelöscht."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Diese Ressource wurde gelöscht."}}},es:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Este recurso ha sido borrado."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Este recurso ha sido vaciado."}}},fr:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Cette ressource a été supprimée."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Cette ressource a été purgée."}}},it:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Questa risorsa è stata eliminata."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Questa risorsa è stata eliminata definitivamente."}}},ja:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"これは削除されました。"}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"これは完全に削除されました。"}}},pt:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Esse recurso foi deletado."}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Esse recurso foi limpo."}}},sw:{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Rasimali hii imefutwa"}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"Rasilimali hii imesafishwa."}}},"zh-Hant":{deletedMessage:{t:0,b:{t:2,i:[{t:3}],s:"該資源已被刪除。"}},purgedMessage:{t:0,b:{t:2,i:[{t:3}],s:"該資源已清除。"}}}}})}const Ot={user:"resource.user",project:"resource.project",form:"resource.form",field_key:"resource.appUser",public_link:"resource.publicLink",dataset:"resource.entityList",config:"resource.config",analytics:"audit.category.task",blobs:"audit.category.task",submission:"audit.category.task",upgrade:"audit.category.upgrade"},D=t=>t.displayName,j={user:{title:D,path:(t,{userPath:e})=>e(t.id)},project:{title:t=>t.name,path:(t,{projectPath:e})=>e(t.id)},form:{title:t=>t.name!=null?t.name:t.xmlFormId,component:U,props:t=>({form:t})},dataset:{title:t=>t.name,component:Q,props:et(["projectId","name"])},public_link:{title:D},field_key:{title:D}};j.upgrade=j.form;const w={name:"AuditRow",components:{ActorLink:dt,DatasetLink:Q,DateTime:ut,FormLink:U,Selectable:ct},props:{audit:{type:Object,required:!0}},setup(){const{actionMessage:t}=A(),{projectPath:e,userPath:i}=it();return{actionMessage:t,projectPath:e,userPath:i}},computed:{category(){const t=this.audit.action.indexOf(".");return t!==-1?this.audit.action.slice(0,t):null},type(){const{action:t}=this.audit,e=this.actionMessage(t);if(e==null)return[t];const i=[e],p=this.category??t,u=Ot[p];return u!=null&&i.unshift(this.$t(u)),i},target(){if(this.category==null)return null;const t=j[this.category];if(t==null)return null;const{actee:e}=this.audit;if(e==null)return null;const i=e.deletedAt!=null,p=e.purgedAt!=null,u={title:p?e.purgedName:t.title(e),deleted:i,purged:p};return i||p||(t.path!=null?u.path=t.path(e,this):t.component!=null&&(u.component=t.component,u.props=t.props(e))),u},details(){return this.audit.details!=null?JSON.stringify(this.audit.details):""}}},Mt={class:"audit-row"},Dt={class:"type"},$t={class:"initiator"},jt={key:0,class:"icon-trash"},zt={key:1,class:"sr-only"},At={class:"target"},Lt={key:0,class:"icon-trash"},wt={key:1,class:"sr-only"};function Tt(t,e,i,p,u,a){const l=k("date-time"),b=k("actor-link"),s=k("router-link"),g=k("selectable"),c=W("tooltip");return n(),r("tr",Mt,[o("td",null,[h(l,{iso:i.audit.loggedAt},null,8,["iso"])]),o("td",Dt,[v(d(a.type[0])+" ",1),a.type.length>1?(n(),r(y,{key:0},[e[0]||(e[0]=o("span",{class:"icon-angle-right"},null,-1)),v(" "+d(a.type[1]),1)],64)):m("",!0)]),o("td",$t,[i.audit.actor!=null?(n(),r(y,{key:0},[i.audit.actor.deletedAt!=null?_((n(),r("span",jt,null,512)),[[c,void 0,void 0,{"sr-only":!0}]]):m("",!0),h(b,{actor:i.audit.actor},null,8,["actor"]),i.audit.actor.deletedAt!=null?(n(),r("span",zt,"  "+d(t.$t("deletedMessage")),1)):m("",!0)],64)):m("",!0)]),o("td",At,[a.target!=null?(n(),r(y,{key:0},[a.target.component!=null?_((n(),$(tt(a.target.component),X(Y({key:0},a.target.props)),null,16)),[[c,void 0,void 0,{text:!0}]]):a.target.path!=null?_((n(),$(s,{key:1,to:a.target.path},{default:C(()=>[v(d(a.target.title),1)]),_:1},8,["to"])),[[c,void 0,void 0,{text:!0}]]):(n(),r(y,{key:2},[a.target.deleted||a.target.purged?_((n(),r("span",Lt,null,512)),[[c,void 0,void 0,{"sr-only":!0}]]):m("",!0),_((n(),r("span",null,[v(d(a.target.title),1)])),[[c,void 0,void 0,{text:!0}]]),a.target.deleted||a.target.purged?(n(),r("span",wt,"  "+d(a.target.deleted?t.$t("deletedMessage"):t.$t("purgedMessage")),1)):m("",!0)],64))],64)):m("",!0)]),o("td",null,[h(g,null,{default:C(()=>[v(d(a.details),1)]),_:1})])])}typeof F=="function"&&F(w);typeof P=="function"&&P(w);const Ct=z(w,[["render",Tt]]);function x(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Initiator"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Target"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Details"}}}}}})}function N(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{cs:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Iniciátor"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Cíl"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Detaily"}}}},de:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Initiator"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Ziel"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Details"}}}},es:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Iniciador"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Objetivo"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Detalles"}}}},fr:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Initiateur"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Cible"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Détails"}}}},id:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Pemrakarsa"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Target"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Rincian"}}}},it:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Iniziatore"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Obbiettivo"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Dettagli"}}}},ja:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"操作者"}},target:{t:0,b:{t:2,i:[{t:3}],s:"操作の対象"}},details:{t:0,b:{t:2,i:[{t:3}],s:"詳細"}}}},pt:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Initiator"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Target"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Detalhes"}}}},sw:{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"Mwanzilishi"}},target:{t:0,b:{t:2,i:[{t:3}],s:"Lengo"}},details:{t:0,b:{t:2,i:[{t:3}],s:"Maelezo"}}}},"zh-Hant":{header:{initiator:{t:0,b:{t:2,i:[{t:3}],s:"引發者"}},target:{t:0,b:{t:2,i:[{t:3}],s:"目標"}},details:{t:0,b:{t:2,i:[{t:3}],s:"細節"}}}}}})}const St={id:"audit-table",class:"table"},Rt={class:"logged-at"},Vt={key:0},T=Object.assign({name:"AuditTable"},{__name:"table",setup(t){const{audits:e}=H();return(i,p)=>(n(),r("table",St,[o("thead",null,[o("tr",null,[o("th",Rt,d(i.$t("header.time")),1),o("th",null,d(i.$t("header.type")),1),o("th",null,d(i.$t("header.initiator")),1),o("th",null,d(i.$t("header.target")),1),o("th",null,d(i.$t("header.details")),1)])]),f(e).dataExists?(n(),r("tbody",Vt,[(n(!0),r(y,null,E(f(e),(u,a)=>(n(),$(Ct,{key:a,audit:u},null,8,["audit"]))),128))])):m("",!0)]))}});typeof x=="function"&&x(T);typeof N=="function"&&N(T);function q(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Here you will find a log of significant actions performed on this server. Changes made to user, Project, or Form settings can be found here."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"There are no matching audit log entries."}}}}})}function B(t){const e=t;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{cs:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Zde najdete protokol významných akcí provedených na tomto serveru. Změny provedené v nastavení uživatele, projektu nebo formuláře najdete zde."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Neexistují žádné odpovídající položky protokolu auditu."}}},de:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Hier befinden sich Log-Einträge signifikanter Aktionen auf diesem Server, wie Änderungen von Benutzer-, Projekt-, oder Formulareinstellungen."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Keine zutreffenden Audit-Logeinträge."}}},es:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Aquí encontrará un registro de acciones significativas realizadas en este servidor. Los cambios realizados en la configuración de usuario, proyecto o formulario se pueden encontrar aquí."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"No hay entradas de registro de auditoría coincidentes."}}},fr:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Vous trouverez ici un log des actions importantes effectuées sur le serveur. Les modifications apportées aux utilisateurs, projets ou formulaires se trouvent ici."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Il n'y a pas d'entrée correspondante dans le journal d'audit."}}},id:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Di sini Anda bisa menemukan catatan tindakan-tindakan yang dilakukan di server ini. Perubahan terhadap pengguna, proyek, atau pengaturan formulir dapat ditemukan di sini."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Tidak ada catatan audit yang cocok."}}},it:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Qui troverai un registro delle azioni significative eseguite su questo server. Le modifiche apportate alle impostazioni dell'utente, del progetto o del formulario sono disponibili qui."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Non sono presenti voci del registro di controllo corrispondenti."}}},ja:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"ここでは、このサーバーで行われた重要な操作履歴を閲覧できます。ユーザーやプロジェクト、フォーム設定への変更は、ここで確認できます。"}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"照合できる監査ログの記録がありません。"}}},pt:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Aqui você encontrará um registro de auditoria de ações importantes realizadas nesse servidor. Alterações feitas a configurações de usuários, projetos ou formulários podem ser encontradas aqui."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Não existem entradas correspondentes no registro de auditoria."}}},sw:{heading:[{t:0,b:{t:2,i:[{t:3}],s:"Hapa utapata logi ya vitendo muhimu vilivyofanywa kwenye seva hii. Mabadiliko yaliyofanywa kwa mipangilio ya mtumiaji, Mradi, au Fomu yanaweza kupatikana hapa."}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"Hakuna maingizo ya kumbukumbu ya ukaguzi yanayolingana"}}},"zh-Hant":{heading:[{t:0,b:{t:2,i:[{t:3}],s:"在這裡您將找到在此伺服器上執行的重要操作的日誌。可以在此處找到對使用者、專案或表單設定所做的變更。"}}],emptyTable:{t:0,b:{t:2,i:[{t:3}],s:"沒有符合的審核日誌條目。"}}}}})}const It={class:"page-body-heading"},Ft={class:"table-actions-bar"},Z=Object.assign({name:"AuditList"},{__name:"list",setup(t){const{createResource:e}=H(),i=e("audits"),{categoryMessage:p,actionMessage:u}=A(),a=R({fromQuery:s=>typeof s.action=="string"&&(p(s.action)!=null||u(s.action)!=null)?s.action:"nonverbose",toQuery:s=>({action:s==="nonverbose"?null:s})}),l=R({fromQuery:s=>{if(typeof s.start=="string"&&typeof s.end=="string"){const c=O.fromISO(s.start),M=O.fromISO(s.end);if(c.isValid&&M.isValid&&c<=M)return[c.startOf("day"),M.startOf("day")]}const g=O.local().startOf("day");return[g,g]},toQuery:s=>{const g=O.local().startOf("day");return s[0].toMillis()===g.toMillis()&&s[1].toMillis()===g.toMillis()?{start:null,end:null}:{start:s[0].toISODate(),end:s[1].toISODate()}}}),b=()=>i.request({url:ot.audits({action:a.value,start:l.value[0].toISO(),end:l.value[1].endOf("day").toISO()}),extended:!0}).catch(rt);return b(),at([a,l],b),(s,g)=>(n(),r("div",null,[o("p",It,d(s.$t("heading[0]")),1),o("div",Ft,[h(vt,{action:f(a),"onUpdate:action":g[0]||(g[0]=c=>S(a)?a.value=c:null),dateRange:f(l),"onUpdate:dateRange":g[1]||(g[1]=c=>S(l)?l.value=c:null)},null,8,["action","dateRange"])]),h(T),h(st,{state:f(i).initiallyLoading},null,8,["state"]),_(o("p",{class:"empty-table-message"},d(s.$t("emptyTable")),513),[[nt,f(i).dataExists&&f(i).length===0]])]))}});typeof q=="function"&&q(Z);typeof B=="function"&&B(Z);export{Z as default};
