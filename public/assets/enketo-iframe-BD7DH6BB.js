import{G as h,u as y,a7 as w,O as $,H as b,J as v,af as I,c as _,p as E,o as S,aA as U}from"./index-BJJ6YbMy.js";const C=["src"],q=Object.assign({name:"EnketoIframe"},{__name:"enketo-iframe",props:{enketoId:{type:String,required:!0},actionType:{type:String,required:!0},instanceId:String},emits:["loaded"],setup(u,{emit:d}){const o=u,p=d,{location:r,buildMode:f}=h("container"),{form:m}=y(),c=w(),g=$(),l=b(()=>{const{return_url:t,returnUrl:e}=c.query;return t&&typeof t=="string"?t:e&&typeof e=="string"?e:null}),k=t=>{const e=document.createElement("iframe");return e.src="/-/single/check-submitted",e.style.display="none",new Promise(s=>{e.onload=()=>{const n=U(t,e.contentDocument);document.body.removeChild(e),s(n)},document.body.appendChild(e)})},i=v();return(()=>{let t="/enketo-passthrough";f==="test"&&(t=`/#${t}`);let e=t;const{search:s}=new URL(c.fullPath,r.origin);let n=`?parentWindowOrigin=${encodeURIComponent(r.origin)}`;n+=s?`&${s.substring(1).split("&").filter(a=>!a.startsWith("return_url=")&&!a.startsWith("returnUrl=")).join("&")}`:"",o.actionType!=="offline"&&(o.actionType==="public-link"?e+="/single":o.actionType==="preview"&&(e+=`/${o.actionType}`),o.enketoId===m.enketoOnceId?k(o.enketoId).then(a=>{a?i.value=`${t}/thanks?taken=${a}`:i.value=`${e}/${o.enketoId}${n}`}):i.value=`${e}/${o.enketoId}${n}`,p("loaded"))})(),I(window,"message",t=>{if(t.origin===r.origin){const{parentWindowOrigin:e}=c.query;r!==window.parent.location&&e&&typeof e=="string"&&window.parent.postMessage(t.data,e);let s;try{s=JSON.parse(t.data)}catch{}if(s?.enketoEvent==="submissionsuccess"&&o.actionType==="public-link"&&l.value)try{const n=new URL(l.value);["http:","https:"].includes(n.protocol)&&(n.origin===r.origin?g.push(n.pathname):r.assign(n))}catch{}}},!1),(t,e)=>i.value?(S(),_("iframe",{key:0,id:"enketo-iframe",title:"Enketo",src:i.value},null,8,C)):E("",!0)}});export{q as default};
