import{_ as O,r as E,l as M,c as r,o as i,g,p as d,e as _,i as m,d as k,k as w,q as N,f as y,t as c,F as z,j as I,u as T,z as Z,at as W,au as X,av as C,Z as R,aw as G,ax as K,a0 as V,C as S,h as F,L as Q,Q as J,D as U,n as P,W as Y}from"./index-BJJ6YbMy.js";import{_ as $}from"./breadcrumbs-SpsHxTta.js";import{_ as tt}from"./infonav-l5ienlGM.js";import{_ as et}from"./link-6wXOPrfc.js";import{_ as st}from"./head-DeISpnNl.js";import{u as at}from"./tabs-BBTLywO7.js";import{u as it}from"./datasets-C5NDv_lC.js";import"./linkable-ByHyCO2J.js";import"./hover-card-hXE3Fll1.js";function B(a){const t=a;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{en:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Back to Project Overview"}}}},formNav:{tabTitle:{t:0,b:{t:2,i:[{t:3}],s:"Publish this Draft Form to enable these functions"}}},infoNav:{entityLists:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Related Entity List"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Related Entity Lists"}]}]}},updatedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Updates"}},attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Uses"}},appUsers:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" App User assigned"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" App Users assigned"}]}]}}}}}})}function H(a){const t=a;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{cs:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Zpět na přehled projektu"}}}}},de:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Zurück zur Projektübersicht"}}}},formNav:{tabTitle:{t:0,b:{t:2,i:[{t:3}],s:"Veröffentlichen Sie diesen Formularentwurf, um diese Funktionen zu aktivieren"}}},infoNav:{entityLists:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Verwandte Entitätsliste"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Verwandte Entitätslisten"}]}]}},updatedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Aktualisierungen"}},attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Verwendet"}},appUsers:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" App-Benutzer zugewiesen"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" App-Benutzer zugewiesen"}]}]}}}},es:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Volver a la descripción general del proyecto."}}}},formNav:{tabTitle:{t:0,b:{t:2,i:[{t:3}],s:"Publique este borrador de formulario para habilitar estas funciones"}}},infoNav:{entityLists:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Lista de entidades relacionadas"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Listas de entidades relacionadas"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Listas de entidades relacionadas"}]}]}},updatedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Actualizaciones"}},attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Usos"}},appUsers:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Usuario de la aplicación asignados"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Usuarios de la aplicación asignados"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Usuarios de la aplicación asignados"}]}]}}}},fr:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Retourner à l'aperçu du projet"}}}},formNav:{tabTitle:{t:0,b:{t:2,i:[{t:3}],s:"Publier cette Ébauche de Formulaire pour activer ces fonctions"}}},infoNav:{entityLists:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Liste d'Entité liée"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Listes d'Entité liées"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Liste(s) d'Entité liée(s)"}]}]}},updatedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Mises à jour"}},attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Utilise"}},appUsers:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Utilisateur mobile assigné"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Utilisateurs mobile assignés"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Utilisateur(s) mobile assigné(s)"}]}]}}}},id:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Kembali ke Gambaran Proyek"}}}}},it:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Torna alla panoramica del progetto"}}}},formNav:{tabTitle:{t:0,b:{t:2,i:[{t:3}],s:"Pubblicare questa bozza di formulario per abilitare queste funzioni"}}},infoNav:{entityLists:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Elenco di entità correlate"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Elenchi di entità correlate"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Elenchi di entità correlate"}]}]}},updatedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Aggiornamenti"}},attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Utilizzi"}},appUsers:{t:0,b:{t:1,c:[{t:2,i:[{t:4,k:"count"},{t:3,v:" Utente App assegnato"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Utenti App assegnati"}]},{t:2,i:[{t:4,k:"count"},{t:3,v:" Utenti App assegnati"}]}]}}}},ja:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"プロジェクトの概要に戻る"}}}}},pt:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Voltar à visão geral do projeto"}}}},infoNav:{attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"Utiliza"}}}},sw:{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"Rudi kwa Muhtasari wa Mradi"}}}}},"zh-Hant":{projectNav:{action:{back:{t:0,b:{t:2,i:[{t:3}],s:"返回專案概覽"}}}},formNav:{tabTitle:{t:0,b:{t:2,i:[{t:3}],s:"發布此表格草稿以啟用這些功能"}}},infoNav:{entityLists:{t:0,b:{t:2,i:[{t:4,k:"count"},{t:3,v:"個相關實體清單"}]}},updatedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"更新"}},attachedDatasets:{t:0,b:{t:2,i:[{t:3}],s:"用途"}},appUsers:{t:0,b:{t:2,i:[{t:3,v:"已指派"},{t:4,k:"count"},{t:3,v:"位 App 使用者"}]}}}}}})}const q={name:"FormHead",components:{Breadcrumbs:$,DatasetLink:et,Infonav:tt,PageHead:st},setup(){const{project:a,form:t,formDatasetDiff:f,publishedAttachments:e,appUserCount:p}=T(),{projectPath:o,formPath:b,canRoute:h}=Z(),{tabPath:l,tabClass:u}=at(b());return{project:a,form:t,formDatasetDiff:f,publishedAttachments:e,appUserCount:p,projectPath:o,formPath:b,canRoute:h,tabPath:l,tabClass:u}},computed:{rendersFormTabs(){return this.project.dataExists&&this.project.permits(["form.update"])},formTabDescription(){return this.form.dataExists&&this.form.publishedAt==null?this.$t("formNav.tabTitle"):null},breadcrumbLinks(){return[{text:this.project.dataExists?this.project.nameWithArchived:this.$t("resource.project"),path:this.projectPath(),icon:"icon-archive"},{text:this.form.dataExists?this.form.nameOrId:this.$t("resource.form"),path:this.form.publishedAt!=null?this.formPath():"",icon:"icon-file"}]},uniqueDatasetCount(){return new Set([...this.formDatasetDiff.map(t=>t.name),...this.publishedAttachments.linkedDatasets]).size}},methods:{formTabClass(a){const t=this.tabClass(a);return this.form.dataExists&&this.form.publishedAt==null&&(t.disabled=!0),t}}},ot={id:"form-head"},rt={key:0},nt={class:"dropdown-header"},ct={key:1},lt={key:2},ut={class:"dropdown-header"},dt={key:0,class:"badge"},mt={key:0,class:"badge"},ft={key:0,class:"badge"};function pt(a,t,f,e,p,o){const b=E("breadcrumbs"),h=E("dataset-link"),l=E("infonav"),u=E("router-link"),j=E("page-head"),v=M("tooltip");return i(),r("div",ot,[e.project.dataExists?(i(),g(b,{key:0,links:o.breadcrumbLinks},null,8,["links"])):d("",!0),_(j,null,{title:m(()=>[y(c(e.form.dataExists?e.form.nameOrId:""),1)]),infonav:m(()=>[e.project.dataExists&&e.formDatasetDiff.dataExists&&e.publishedAttachments.dataExists&&o.uniqueDatasetCount>0?(i(),g(l,{key:0},{title:m(()=>[t[0]||(t[0]=k("span",{class:"icon-magic-wand"},null,-1)),y(c(a.$tc("infoNav.entityLists",o.uniqueDatasetCount)),1)]),dropdown:m(()=>[e.formDatasetDiff.length>0?(i(),r("li",rt,[k("span",nt,c(a.$t("infoNav.updatedDatasets")),1)])):d("",!0),(i(!0),r(z,null,I(e.formDatasetDiff,s=>(i(),r("li",{key:s.name},[_(h,{name:s.name,"project-id":e.project.id},null,8,["name","project-id"])]))),128)),e.formDatasetDiff.length>0&&e.publishedAttachments.linkedDatasets.length>0?(i(),r("li",ct,t[1]||(t[1]=[k("hr",{class:"dropdown-divider"},null,-1)]))):d("",!0),e.publishedAttachments.linkedDatasets.length>0?(i(),r("li",lt,[k("span",ut,c(a.$t("infoNav.attachedDatasets")),1)])):d("",!0),(i(!0),r(z,null,I(e.publishedAttachments.linkedDatasets,s=>(i(),r("li",{key:s},[_(h,{name:s,"project-id":e.project.id},null,8,["name","project-id"])]))),128))]),_:1})):d("",!0),e.appUserCount.dataExists?(i(),g(l,{key:1,link:e.projectPath("form-access")},{title:m(()=>[t[2]||(t[2]=k("span",{class:"icon-user"},null,-1)),y(c(a.$tc("infoNav.appUsers",e.appUserCount.data)),1)]),_:1},8,["link"])):d("",!0)]),tabs:m(()=>[k("li",{class:w(o.formTabClass("submissions")),role:"presentation"},[N((i(),g(u,{to:e.tabPath("submissions")},{default:m(()=>[y(c(a.$t("resource.submissions"))+" ",1),e.form.dataExists?(i(),r("span",dt,c(a.$n(e.form.submissions,"default")),1)):d("",!0)]),_:1},8,["to"])),[[v,o.formTabDescription,void 0,{"aria-describedby":!0}]])],2),o.rendersFormTabs?(i(),r("li",{key:0,class:w(o.formTabClass("public-links")),role:"presentation"},[N((i(),g(u,{to:e.tabPath("public-links")},{default:m(()=>[y(c(a.$t("formHead.tab.publicAccess"))+" ",1),e.form.dataExists?(i(),r("span",mt,c(a.$n(e.form.publicLinks,"default")),1)):d("",!0)]),_:1},8,["to"])),[[v,o.formTabDescription,void 0,{"aria-describedby":!0}]])],2)):d("",!0),e.canRoute(e.tabPath("draft"))?(i(),r("li",{key:1,id:"form-head-draft-tab",class:w(e.tabClass("draft")),role:"presentation"},[_(u,{to:e.tabPath("draft")},{default:m(()=>[k("span",null,c(a.$t("formHead.tab.editForm")),1),t[3]||(t[3]=k("span",{class:"icon-pencil"},null,-1))]),_:1,__:[3]},8,["to"])],2)):d("",!0),k("li",{class:w(o.formTabClass("versions")),role:"presentation"},[N((i(),g(u,{to:e.tabPath("versions")},{default:m(()=>[y(c(a.$t("formHead.tab.versions")),1)]),_:1},8,["to"])),[[v,o.formTabDescription,void 0,{"aria-describedby":!0}]])],2),o.rendersFormTabs?(i(),r("li",{key:2,class:w(o.formTabClass("settings")),role:"presentation"},[N((i(),g(u,{to:e.tabPath("settings")},{default:m(()=>[y(c(a.$t("common.tab.settings"))+" ",1),e.form.dataExists?(i(),r("span",ft,c(a.$t(`formState.${e.form.state}`)),1)):d("",!0)]),_:1},8,["to"])),[[v,o.formTabDescription,void 0,{"aria-describedby":!0}]])],2)):d("",!0)]),_:1})])}typeof B=="function"&&B(q);typeof H=="function"&&H(q);const bt=O(q,[["render",pt]]),ht=()=>{const{form:a,createResource:t}=T(),f=t("formVersions",()=>({transformResponse:W})),e=t("formVersionXml"),p=t("formDraft",()=>X(s=>R(K(s)))),o=s=>s.reduce((n,D)=>n.set(D.name,D),new Map),b=t("draftAttachments",()=>({transformResponse:({data:s})=>R(o(s)),missingCount:C(()=>{let s=0;for(const n of b.values())n.exists||(s+=1);return s})})),h=t("publishedAttachments",()=>({transformResponse:({data:s})=>o(s),linkedDatasets:C(()=>{const s=[];for(const n of h.values())n.datasetExists&&s.push(n.name.replace(/\.csv$/i,""));return s})})),l=t("publicLinks",()=>({activeCount:C(()=>l.reduce((s,{token:n})=>s+(n!=null?1:0),0))}));G(()=>{a.dataExists&&l.dataExists&&a.publicLinks!==l.activeCount&&(a.publicLinks=l.activeCount)});const u=t("formDatasetDiff"),j=t("formDraftDatasetDiff",()=>({counts:C(()=>{let s=0,n=0;for(const D of j)if(D.isNew)s+=1,n+=D.properties.length;else{const A=D.properties.reduce((L,x)=>x.isNew?L+1:L,0);A!==0&&(s+=1,n+=A)}return{updatedDatasets:s,newProperties:n}})})),v=t("appUserCount",()=>({transformResponse:({data:s})=>s.length}));return{form:a,formVersions:f,formVersionXml:e,formDraft:p,draftAttachments:b,publishedAttachments:h,publicLinks:l,formDatasetDiff:u,formDraftDatasetDiff:j,appUserCount:v}},At=Object.assign({name:"FormShow"},{__name:"show",props:{projectId:{type:String,required:!0},xmlFormId:{type:String,required:!0}},setup(a){const t=a,{project:f,resourceStates:e}=T(),{form:p,publishedAttachments:o,formDatasetDiff:b,appUserCount:h}=ht();it();const{initiallyLoading:l,dataExists:u}=e([f,p]),j=A=>{f.request({url:U.project(t.projectId),extended:!0,resend:A}).catch(P)},v=()=>{p.request({url:U.form(t.projectId,t.xmlFormId),extended:!0}).catch(P)},s=()=>{Promise.allSettled([o.request({url:U.publishedAttachments(t.projectId,t.xmlFormId)}),b.request({url:U.formDatasetDiff(t.projectId,t.xmlFormId)})])};j(!1),v();const n=V(()=>{f.dataExists&&(f.permits("assignment.list")&&h.request({url:U.formActors(t.projectId,t.xmlFormId,"app-user")}).catch(P),Y(()=>n()))}),D=V(()=>{p.dataExists&&(p.publishedAt!=null&&s(),D())});return(A,L)=>{const x=E("router-view");return i(),r("div",null,[N(_(bt,null,null,512),[[S,F(u)]]),_(J,null,{default:m(()=>[_(Q,{state:F(l)},null,8,["state"]),N(_(x,{onFetchProject:j,onFetchForm:v,onFetchLinkedDatasets:s},null,512),[[S,F(u)]])]),_:1})])}}});export{At as default};
