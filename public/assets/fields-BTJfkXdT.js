import{M as A}from"./textarea-DfIc8ncZ.js";import{_ as q}from"./modal-BMSEXbZM.js";import{_ as B,a as z,D as N,n as V,r as p,g as D,o as m,i as h,d as s,w as I,c as _,F as P,j as T,q as j,e as f,a2 as U,t as d,f as b,J as k,A as M,p as F,T as H,u as O,av as S}from"./index-BJJ6YbMy.js";import{_ as L}from"./review-state-m1o3bY3s.js";import{u as J}from"./request--gXHIWga.js";function w(e){const t=e;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{en:{title:{t:0,b:{t:2,i:[{t:3}],s:"Update Review State"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Notes and comments (optional)"}}}}}})}function y(e){const t=e;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{cs:{title:{t:0,b:{t:2,i:[{t:3}],s:"Aktualizovat stav kontroly"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Poznámky a komentáře (volitelné)"}}}},de:{title:{t:0,b:{t:2,i:[{t:3}],s:"Überprüfungsstatus aktualisieren"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Notizen und Kommentare (optional)"}}}},es:{title:{t:0,b:{t:2,i:[{t:3}],s:"Actualizar estado de revisión"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Notas y comentarios (opcional)"}}}},fr:{title:{t:0,b:{t:2,i:[{t:3}],s:"Changer l'état de la soumission"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Notes et commentaires (facultatif)"}}}},id:{title:{t:0,b:{t:2,i:[{t:3}],s:"Perbarui status ulasan"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Catatan dan komentar (opsional)"}}}},it:{title:{t:0,b:{t:2,i:[{t:3}],s:"Aggiorna lo Stato Revisione"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Note e commenti (opzionale)"}}}},ja:{title:{t:0,b:{t:2,i:[{t:3}],s:"レビュー・ステータスの更新"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"メモとコメント（任意）"}}}},pt:{title:{t:0,b:{t:2,i:[{t:3}],s:"Atualizar status de revisão"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Observações e comentários (opcional)"}}}},sw:{title:{t:0,b:{t:2,i:[{t:3}],s:"Sasisha Uhakiki wa hali"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"Vidokezo na maoni (si lazima)"}}}},"zh-Hant":{title:{t:0,b:{t:2,i:[{t:3}],s:"更新審核狀態"}},field:{notes:{t:0,b:{t:2,i:[{t:3}],s:"註釋和評論（可選）"}}}}}})}const C=["approved","hasIssues","rejected"],g={name:"SubmissionUpdateReviewState",components:{MarkdownTextarea:A,Modal:q,Spinner:z,SubmissionReviewState:L},props:{state:Boolean,projectId:{type:String,required:!0},xmlFormId:{type:String,required:!0},submission:Object},emits:["hide","success"],setup(){const{request:e,awaitingResponse:t}=J();return{request:e,awaitingResponse:t}},data(){return{selectedState:"approved",notes:""}},computed:{selectableStates(){return C}},watch:{state(e){if(e){const t=this.submission.__system.reviewState;this.selectedState=C.includes(t)?t:"approved",this.$nextTick(()=>{this.$refs.form.querySelector("input:checked").focus()})}else this.notes=""}},methods:{submit(){const e={};this.notes!==""&&(e["X-Action-Notes"]=encodeURIComponent(this.notes)),this.request({method:"PATCH",url:N.submission(this.projectId,this.xmlFormId,this.submission.__id),data:{reviewState:this.selectedState},headers:e}).then(()=>{this.$emit("success",this.submission,this.selectedState)}).catch(V)}}},K={class:"row"},Q={class:"col-xs-4"},W=["value"],X={class:"col-xs-8"},G={class:"form-group"},Y={class:"modal-actions"},Z=["aria-disabled"],tt=["aria-disabled"];function et(e,t,n,i,o,r){const c=p("submission-review-state"),v=p("markdown-textarea"),l=p("spinner"),u=p("modal");return m(),D(u,{id:"submission-update-review-state",state:n.state,hideable:!i.awaitingResponse,backdrop:"",onHide:t[4]||(t[4]=a=>e.$emit("hide"))},{title:h(()=>[b(d(e.$t("title")),1)]),body:h(()=>[s("form",{ref:"form",onSubmit:t[3]||(t[3]=I((...a)=>r.submit&&r.submit(...a),["prevent"]))},[s("div",K,[s("div",Q,[(m(!0),_(P,null,T(r.selectableStates,a=>(m(),_("div",{key:a,class:"radio"},[s("label",null,[j(s("input",{"onUpdate:modelValue":t[0]||(t[0]=E=>o.selectedState=E),type:"radio",value:a},null,8,W),[[U,o.selectedState]]),f(c,{value:a,align:""},null,8,["value"])])]))),128))]),s("div",X,[s("div",G,[f(v,{modelValue:o.notes,"onUpdate:modelValue":t[1]||(t[1]=a=>o.notes=a),"default-text":e.$t("field.notes"),"show-footer":i.awaitingResponse},null,8,["modelValue","default-text","show-footer"])])])]),s("div",Y,[s("button",{type:"button",class:"btn btn-link","aria-disabled":i.awaitingResponse,onClick:t[2]||(t[2]=a=>e.$emit("hide"))},d(e.$t("action.neverMind")),9,Z),s("button",{type:"submit",class:"btn btn-primary","aria-disabled":i.awaitingResponse},[b(d(e.$t("action.update"))+" ",1),f(l,{state:i.awaitingResponse},null,8,["state"])],8,tt)])],544)]),_:1},8,["state","hideable"])}typeof w=="function"&&w(g);typeof y=="function"&&y(g);const bt=B(g,[["render",et]]);function $(e){const t=e;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{en:{title:{t:0,b:{t:2,i:[{t:3}],s:"Delete Submission"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"Are you sure you want to delete this Submission?"}},{t:0,b:{t:2,i:[{t:3}],s:"This action will move the Submission to the Trash. After 30 days in the Trash, it will be permanently purged, but it can be restored before then."}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"Delete immediately without confirmation until I leave the page"}}}}}})}function R(e){const t=e;t.__i18n=t.__i18n||[],t.__i18n.push({locale:"",resource:{de:{title:{t:0,b:{t:2,i:[{t:3}],s:"Übermittlung löschen"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"Sind Sie sicher, dass Sie diese Übermittlung löschen möchten?"}},{t:0,b:{t:2,i:[{t:3}],s:"Diese Aktion verschiebt die Übermittlung in den Papierkorb. Nach 30 Tagen im Papierkorb wird es dauerhaft gelöscht, kann aber vorher wiederhergestellt werden."}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"Sofortiges Löschen ohne Bestätigung, bis ich die Seite verlasse"}}}},es:{title:{t:0,b:{t:2,i:[{t:3}],s:"Borrar envío"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"¿Está seguro de que desea eliminar este envío?"}},{t:0,b:{t:2,i:[{t:3}],s:"Esta acción moverá el Envío a la Papelera. Después de 30 días en la Papelera, se purgará permanentemente, pero puede deshacerse su eliminación antes de ese plazo."}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"Borrar inmediatamente sin confirmación hasta que salga de la página"}}}},fr:{title:{t:0,b:{t:2,i:[{t:3}],s:"Supprimer la Soumission"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"Etes vous sûr de vouloir supprimer cette Soumission ?"}},{t:0,b:{t:2,i:[{t:3}],s:"Cette action va déplacer les Soumissions dans la Corbeille. Après 30 jours dans la Corbeille, elles seront purgées de manière permanente, mais elles peuvent être restaurées avant ce délai."}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"Supprimer immédiatement sans confirmation jusqu'à ce que je quitte la page"}}}},it:{title:{t:0,b:{t:2,i:[{t:3}],s:"Elimina invio"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"Sei sicuro di voler cancellare questo invio?"}},{t:0,b:{t:2,i:[{t:3}],s:"Questa azione sposterà il formulario nel Cestino. Dopo 30 giorni nel Cestino, verrà eliminato definitivamente, ma prima di allora può essere ripristinato."}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"Elimina immediatamente senza conferma finché non lascio la pagina"}}}},pt:{title:{t:0,b:{t:2,i:[{t:3}],s:"Deletar Resposta"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"Você tem certeza que quer deletar esta Resposta?"}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"Excluir imediatamente sem confirmação até que eu saia da página"}}}},"zh-Hant":{title:{t:0,b:{t:2,i:[{t:3}],s:"刪除提交內容"}},introduction:[{t:0,b:{t:2,i:[{t:3}],s:"您確定要刪除此提交嗎？"}},{t:0,b:{t:2,i:[{t:3}],s:"此操作會將提交內容移至垃圾箱。在垃圾箱中保留 30 天后，它將被永久清除，但在此之前可以還原。"}}],field:{noConfirm:{t:0,b:{t:2,i:[{t:3}],s:"立即刪除，無需確認，直到我離開頁面"}}}}}})}const it={class:"modal-introduction"},st={key:0},nt={class:"checkbox"},ot={class:"modal-actions"},at=["aria-disabled"],lt=["aria-disabled"],x=Object.assign({name:"SubmissionDelete"},{__name:"delete",props:{state:Boolean,checkbox:Boolean,awaitingResponse:Boolean,submission:Object},emits:["hide","delete"],setup(e,{emit:t}){const n=e,i=t,o=k(!1);M(()=>n.state,l=>{l||(o.value=!1)});const r=k(null),c=()=>{n.checkbox&&r.value.focus()},v=()=>{n.checkbox?i("delete",[n.submission,!o.value]):i("delete",[n.submission])};return(l,u)=>(m(),D(q,{id:"submission-delete",state:e.state,hideable:!e.awaitingResponse,backdrop:"",onHide:u[2]||(u[2]=a=>l.$emit("hide")),onShown:c},{title:h(()=>[b(d(l.$t("title")),1)]),body:h(()=>[s("div",it,[s("p",null,d(l.$t("introduction[0]")),1),s("p",null,d(l.$t("introduction[1]")),1)]),e.checkbox?(m(),_("form",st,[s("div",nt,[s("label",null,[j(s("input",{ref_key:"input",ref:r,"onUpdate:modelValue":u[0]||(u[0]=a=>o.value=a),type:"checkbox"},null,512),[[H,o.value]]),b(" "+d(l.$t("field.noConfirm")),1)])])])):F("",!0),s("div",ot,[s("button",{type:"button",class:"btn btn-link","aria-disabled":e.awaitingResponse,onClick:u[1]||(u[1]=a=>l.$emit("hide"))},d(l.$t("action.cancel")),9,at),s("button",{type:"button",class:"btn btn-danger","aria-disabled":e.awaitingResponse,onClick:v},[b(d(l.$t("action.delete"))+" ",1),f(z,{state:e.awaitingResponse},null,8,["state"])],8,lt)])]),_:1},8,["state","hideable"]))}});typeof $=="function"&&$(x);typeof R=="function"&&R(x);const pt=()=>{const{createResource:e}=O();return e("fields",t=>({transformResponse:({data:n})=>{for(const i of n)i.pathElements=i.path.split("/"),i.pathElements.shift(),i.header=i.pathElements.join("-");return n},selectable:S(()=>{const n=[];let i=null;for(const o of t){const{path:r}=o;if(i==null||!r.startsWith(i)){i=null;const{type:c}=o;c==="repeat"?i=`${r}/`:c!=="structure"&&r!=="/meta/instanceID"&&r!=="/instanceID"&&n.push(o)}}return n}),binaryPaths:S(()=>t.reduce((n,i)=>i.binary?n.add(i.path):n,new Set))}))};export{bt as S,x as _,pt as u};
