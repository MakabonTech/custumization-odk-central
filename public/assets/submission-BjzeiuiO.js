import{m as U,a7 as N,z as $,G as B,ao as x,O,u as D,K as T,H as F,J as z,$ as g,a1 as w,A as W,a0 as H,c as V,o as l,g as f,p as _,i as G,e as J,L as K,Q,h as c,F as M,D as m,n as j}from"./index-BJJ6YbMy.js";import X from"./not-found-BQ6JkU8Y.js";const Y=U(({router:o,requestData:e})=>{const i=N(),{form:t}=e,{newSubmissionPath:s,formPreviewPath:p,offlineSubmissionPath:a}=$(),{location:b}=B("container");return{ensureCanonicalPath:u=>{let r;if(i.path.startsWith("/f/")&&!i.query.st&&t.dataExists&&(u==="new"?r=s(t.projectId,t.xmlFormId,!t.publishedAt):u==="preview"?r=p(t.projectId,t.xmlFormId,!t.publishedAt):u==="offline"?r=a(t.projectId,t.xmlFormId,!t.publishedAt):u==="public-link"&&(r=s(t.projectId,t.xmlFormId,!t.publishedAt)),r)){const{instance_id:h,...I}=i.query;o.replace(`${r}${x(I)}`)}},ensureEnketoOfflinePath:u=>{if(u==="offline"&&t.dataExists&&!t.webformsEnabled){const r=i.params.enketoId??t.enketoId;return b.replace(`/-/x/${r}${x(i.query)}`),!0}return!1}}});function S(o){const e=o;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{en:{formNotFound:{t:0,b:{t:2,i:[{t:3}],s:"No Form found with this URL, please double check."}}}}})}function L(o){const e=o;e.__i18n=e.__i18n||[],e.__i18n.push({locale:"",resource:{de:{formNotFound:{t:0,b:{t:2,i:[{t:3}],s:"Für diese URL wurde kein Formular gefunden, bitte überprüfen Sie dies noch einmal."}}},es:{formNotFound:{t:0,b:{t:2,i:[{t:3}],s:"No se ha encontrado ningún formulario con esta URL, vuelva a comprobarlo."}}},fr:{formNotFound:{t:0,b:{t:2,i:[{t:3}],s:"Aucun Formulaire trouvé avec cette URL, merci de vérifier."}}},it:{formNotFound:{t:0,b:{t:2,i:[{t:3}],s:"Non è stato trovato alcun modulo con questo URL, si prega di ricontrollare."}}},"zh-Hant":{formNotFound:{t:0,b:{t:2,i:[{t:3}],s:"此 URL 未找到表單，請仔細檢查。"}}}}})}const R=Object.assign({name:"FormSubmission"},{__name:"submission",props:{projectId:String,xmlFormId:String,instanceId:String,actionType:{type:String,required:!0,validator(o){return["new","edit","public-link","offline","preview"].includes(o)}},enketoId:String,draft:Boolean},setup(o){const e=o,i=N(),t=O(),{project:s,resourceStates:p,form:a}=D(),{t:b}=T(),{ensureEnketoOfflinePath:E,ensureCanonicalPath:v}=Y(),u=F(()=>e.projectId?[s,a]:[a]),r=z(!0),h=()=>{r.value=!1},{initiallyLoading:I,dataExists:d}=F(()=>{const n=p(u.value);return{initiallyLoading:n.initiallyLoading,dataExists:n.dataExists}}).value,q=g(w("WebFormRenderer")),P=g(w("EnketoIframe")),A=()=>s.request({url:m.project(e.projectId),extended:!0}).catch(j),C=()=>{let n="";e.projectId&&e.xmlFormId?n=e.draft?m.formDraft(e.projectId,e.xmlFormId):m.form(e.projectId,e.xmlFormId):n=m.formByEnketoId(e.enketoId,{st:i.query.st}),a.request({url:n,resend:!1,problemToAlert:y=>y.code===404.1?b("formNotFound"):null}).then(()=>{E(e.actionType)?s.cancelRequest():v(e.actionType)}).catch(j)},k=F(()=>{if(!s.dataExists||!a.dataExists)return!0;let n=!0;return(i.name==="SubmissionNew"||i.name==="DraftSubmissionNew")&&!s.permits("submission.create")&&(n=!1),i.name==="SubmissionEdit"&&!s.permits(["submission.read","submission.update"])&&(n=!1),!s.permits("form.read")&&!s.permits("open_form.read")&&(n=!1),!s.permits("form.read")&&s.permits("open_form.read")&&a.state!=="open"&&(n=!1),n});return W(()=>I.value,n=>{n||(r.value=d.value)}),H(()=>{d.value&&(k.value||t.push("/"))}),e.projectId&&A(),a.dataExists||C(),(n,y)=>(l(),V(M,null,[r.value?(l(),f(Q,{key:0},{default:G(()=>[J(K,{state:!0})]),_:1})):_("",!0),c(d)&&!c(a).webformsEnabled&&o.actionType==="edit"?(l(),f(X,{key:1})):c(d)&&c(a).webformsEnabled&&k.value?(l(),f(c(q),{key:2,"action-type":o.actionType,"instance-id":o.instanceId,onLoaded:h},null,8,["action-type","instance-id"])):c(d)&&!c(a).webformsEnabled&&k.value?(l(),f(c(P),{key:3,"enketo-id":o.enketoId??c(a).enketoId,"action-type":o.actionType,"instance-id":o.instanceId,onLoaded:h},null,8,["enketo-id","action-type","instance-id"])):_("",!0)],64))}});typeof S=="function"&&S(R);typeof L=="function"&&L(R);export{R as default};
